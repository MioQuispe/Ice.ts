mode_run,existing_server,existing_mode,active_leases_before,args_mismatch,args_mismatch_selection,concurrency,parallel_role,expected_action,expected_managed_after,expected_mode_after,expected_pid_change,expected_leases_after,expect_server_running_during,expect_statejson_present_during,expect_server_running_after_exit,expect_statejson_present_after_exit,expected_error,notes
foreground,none,—,0,no,reuse,single,—,spawn,TRUE,foreground,different,1,TRUE,TRUE,FALSE,FALSE,—,"“Start in foreground with no server running: spawn a new managed server in FG, acquire one lease for the task, terminate the server on task exit; no state file left behind.”,"
background,none,—,0,no,reuse,single,—,spawn,TRUE,background,different,1,TRUE,TRUE,TRUE,TRUE,—,"“Start in background with no server running: spawn a new managed server in BG, acquire one lease, keep it running after the task; state file persists.”,"
foreground,managed,foreground,0,no,reuse,single,—,reuse,TRUE,foreground,same,1,TRUE,TRUE,FALSE,FALSE,—,"“FG run while a managed FG server exists (no args mismatch): reuse existing server, add a lease, same PID; server continues only while any lease remains.”,"
foreground,managed,background,0,no,reuse,single,—,reuse,TRUE,background,same,1,TRUE,TRUE,TRUE,TRUE,—,"“FG run while a managed BG server exists (no args mismatch): reuse the BG server, add a lease; BG server remains since it’s background-managed.”,"
background,managed,foreground,0,no,reuse,single,—,reuse,TRUE,foreground,same,1,TRUE,TRUE,TRUE,TRUE,—,"“BG run while a managed FG server exists (no args mismatch): reuse the existing FG server (same PID), add a lease; it stays up after task.”,"
foreground,managed,foreground,0,yes,restart,single,—,restart,TRUE,foreground,different,1,TRUE,TRUE,FALSE,FALSE,—,"“FG run with managed FG server, args mismatch and selection=restart: gracefully restart into FG with new args, PID changes, single lease remains.”,"
background,managed,foreground,0,yes,restart,single,—,restart,TRUE,background,different,1,TRUE,TRUE,TRUE,TRUE,—,"“BG run with managed FG server, args mismatch and selection=restart: gracefully restart into BG with new args, PID changes, single lease remains and server stays up.”,"
foreground,managed,background,0,yes,restart,single,—,restart,TRUE,foreground,different,1,TRUE,TRUE,FALSE,FALSE,—,"“FG run with managed BG server, args mismatch and selection=restart: gracefully restart into FG with new args, PID changes, lease remains; server stops on task exit.”,"
background,managed,background,0,yes,restart,single,—,restart,TRUE,background,different,1,TRUE,TRUE,TRUE,TRUE,—,"“BG run with managed BG server, args mismatch and selection=restart: gracefully restart into BG with new args, PID changes, lease remains; server stays up.”,"
foreground,managed,foreground,>0,no,reuse,single,—,reuse,TRUE,foreground,same,>0,TRUE,TRUE,TRUE,TRUE,—,"“FG run with managed FG server and existing leases>0, no args mismatch: reuse same PID, increment lease count; server remains up while any lease exists.”,"
background,managed,foreground,>0,yes,restart,single,—,reject-in-use,TRUE,foreground,n/a,n/a,FALSE,TRUE,TRUE,TRUE,in-use,"“BG run with managed FG server, existing leases>0, args mismatch and selection=restart: reject restart because in-use; task fails without changing the running server.”,"
foreground,managed,background,>0,yes,restart,single,—,reject-in-use,TRUE,background,n/a,n/a,FALSE,TRUE,TRUE,TRUE,in-use,"“FG run with managed BG server, existing leases>0, args mismatch and selection=restart: reject restart because in-use; task fails without changing the running server.”,"
foreground,manual,—,0,no,reuse,single,—,adopt-manual,FALSE,—,n/a,1,TRUE,TRUE,TRUE,TRUE,—,"“FG run with a manually started server present (no args mismatch): adopt manual server (no killing or restarting), treat as in-use; server remains after exit.”,"
foreground,manual,—,0,yes,restart,single,—,reject-cannot-restart-manual,FALSE,—,n/a,n/a,FALSE,TRUE,TRUE,TRUE,cannot-restart-manual,"“FG run with manual server present, args mismatch and selection=restart: cannot restart manual; task is rejected, manual server unaffected.”,"
background,manual,—,0,no,reuse,single,—,adopt-manual,FALSE,—,n/a,1,TRUE,TRUE,TRUE,TRUE,—,"“BG run with manual server present (no args mismatch): adopt manual server as-is, do not manage lifecycle; server remains after the task.”,"
background,manual,—,0,yes,restart,single,—,reject-cannot-restart-manual,FALSE,—,n/a,n/a,FALSE,TRUE,TRUE,TRUE,cannot-restart-manual,"“BG run with manual server present, args mismatch and selection=restart: cannot restart manual; task is rejected, manual server unaffected.”,"
foreground,none,—,0,no,reuse,parallel,first,spawn,TRUE,foreground,different,1,TRUE,TRUE,FALSE,FALSE,—,"“Parallel FG tasks with no server initially: first task spawns FG server and obtains a lease; second task will arrive later.”,"
foreground,none,—,0,no,reuse,parallel,second,reuse,TRUE,foreground,same,2,TRUE,TRUE,FALSE,FALSE,—,"“Parallel FG tasks with no server initially: second task reuses server spawned by first, obtaining a second lease; server stops when both exit (leases reach 0).”,"
background,none,—,0,no,reuse,parallel,first,spawn,TRUE,background,different,1,TRUE,TRUE,TRUE,TRUE,—,"“Parallel BG tasks with no server initially: first task spawns BG server and obtains a lease; server will remain after tasks finish.”,"
background,none,—,0,no,reuse,parallel,second,reuse,TRUE,background,same,2,TRUE,TRUE,TRUE,TRUE,—,"“Parallel BG tasks with no server initially: second task reuses BG server, obtains a second lease; server remains running after all tasks exit.”,"
foreground,managed,foreground,1,no,reuse,parallel,second,reuse,TRUE,foreground,same,2,TRUE,TRUE,TRUE,TRUE,—,"“Parallel FG second task while managed FG exists with 1 lease (no mismatch): reuse same PID, lease count -> 2; server continues while leases >0.”,"
foreground,managed,foreground,1,yes,restart,parallel,second,reject-in-use,TRUE,foreground,n/a,n/a,FALSE,TRUE,TRUE,TRUE,in-use,"“Parallel FG second task while managed FG exists with 1 lease, args mismatch and selection=restart: reject restart because in-use; leave server untouched.”,"
background,managed,background,1,no,reuse,parallel,second,reuse,TRUE,background,same,2,TRUE,TRUE,TRUE,TRUE,—,"“Parallel BG second task while managed BG exists with 1 lease (no mismatch): reuse same PID, lease count -> 2; BG server remains running.”,"
foreground,managed,background,1,yes,restart,parallel,second,reject-in-use,TRUE,background,n/a,n/a,FALSE,TRUE,TRUE,TRUE,in-use,"“Parallel FG second task while managed BG exists with 1 lease, args mismatch and selection=restart: reject restart because in-use; leave server untouched.”,"